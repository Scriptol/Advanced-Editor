<!--
Advanced Editor File Load Dialog (c) 2012-2015 Denis Sureau
License GPL 3.0
-->
<html>
<head>
<title>AEdit Loader</title>
<link type="text/css" href="code/saver.css" rel="stylesheet">
<script src="code/filelist.js" type="text/javascript"></script>
<script src="code/aedit.ini.js"></script>
<script src="code/javascript-ini.js"></script>
</head>
<body>

<div id="main">
    <div id="lcontent"></div>
	    <div id="fspath" oncontextmenu="return false">
            <div id="pathlabel" style="color:#093">LOAD</div> 
            <div id="pathcontrol">
      	    <input type="text" class="innpath" id="lcontentpath" size="45" value="/">
            <input type="button" class="bpath button bgray" value="Cancel" onclick="cancel()"/>
            <input type="button" class="bpath bsave button bgreen" value="Edit" onclick="loadToEdit()"/>    
            <input type="button" class="bpath bsave button bgreen" id="prjButton" style="display:none" value="Load" onclick="loadProject()"/>
        </div>
    </div>
</div>

<script>

var socket = new WebSocket("ws://localhost:1034");

function addKeyListEvents(target) { 
  target=null; // nothing
}

function setLoadPath() {
  SyncPath = document.getElementById("lcontentpath")  // SyncPath from FileList
  //alert(config.dir + " " +config.path)
  parent.AEditSyncPath = SyncPath;
}

function cancel() {
  parent.restartEditor(); 
}
    
function extractDir(fname)  {
    var p = fname.lastIndexOf("/")
    return fname.slice(0, p)
}

function loadToEdit() {
  var f = document.getElementById("lcontentpath").value
  parent.AEditFileName = f
  parent.load()
  config.dir = extractDir(f)
  config.path = f;
  saveIni("/code/aedit.ini.js")
  parent.restartEditor()
}
    
function loadProject() {
  var pname = document.getElementById("lcontentpath").value
  parent.loadProject(pname)  
  parent.restartEditor()
}    

socket.onmessage = function(event) {
  var jobj =   JSON.parse(event.data);
  //alert(jobj.type)   
  switch(jobj.type) {
    case 'dirdata':
        //alert("DIRDATA")
          fileList(jobj, 0);
          config.path = jobj.path;
        break;
    default:
        //alert(jobj.type)    
  }           
};        

function fileAccess(target)
{
	var query = { 
    'app' : 'explorer', 
    'params': { 
        'path' : config.dir, 
        'command': 'saveas', 
        'target': target,
        'drag' : false 
        } 
  };
  sendFromInterface(query);
}	

function startLoader()
{
  fileAccess("lcontent");
}

  
</script>	

</body>
</html>