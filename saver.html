<!--
Advanced Editor File Save Dialog (c) 2012-2017 Denis Sureau
License GPL 3.0
-->
<html>
<head>
<title>AE Saver</title>
<link type="text/css" href="code/saver.css" rel="stylesheet">
<script src="code/filelist.js" type="text/javascript"></script>
<script src="aedit.ini.js"></script>
<script src="code/javascript-ini.js"></script>
</head>
<body>

<div id="main">
    <div id="scontent"></div>
	  <div id="fspath" oncontextmenu="return false">
        <div id="pathlabel" style="color:#06C"> SAVE TO </div>
        <div id="pathcontrol">
      	  <input type="text" class="innpath" id="scontentpath" size="40" value="/" onkeyup="chgPath(this)">
          <input type="button" class="bpath button bgray" value="Cancel" onclick="cancel()"/>
          <input type="button" class="bpath bsave button bblue" value="Save" onclick="saveConfirmed()"/>
        </div>
    </div>
</div>

<script>

var socket = new WebSocket("ws://localhost:1034");

function addKeyListEvents(target) {
  target=null; // nothing
}

function setSavePath() {
  SyncPath = document.getElementById("scontentpath")
  parent.AEditSyncPath = SyncPath;
}

function cancel() {
  parent.restartEditor();
}

function extractDir(fname)  {
    var p = fname.lastIndexOf("/")
    return fname.slice(0, p)
}

function saveConfirmed() {
  var f = document.getElementById("scontentpath").value
  parent.AEditFileName  = f
  parent.save(false)
  config.dir = extractDir(f)
  config.path = f;
  saveIni("aedit.ini.js")
  parent.restartEditor();
}


socket.onmessage = function(event) {
  var jobj =   JSON.parse(event.data);
  switch(jobj.type) {
    case 'dirdata':
        fileList(jobj, 0);
        config.path = jobj.path;
        document.getElementById("scontentpath").value = parent.AEditFileName
        break;
    default:
  }
};

function fileAccess()
{
  if(config.path == '') { config.path = "/";  }
	var query = {
    'app' : 'explorer',
    'params': {
        'path' : config.dir,
        'command': 'saveas',
        'target': 'scontent',
        'drag' : false
        }
  };
  sendFromInterface(query);
}

function startSaver()
{
    fileAccess();
}


</script>

</body>
</html>
